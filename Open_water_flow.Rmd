---
title: "Open water flow"
output: 
  html_notebook:
   css:  want_n.css
author: G. Bier
---

# Introduction

This document is designed to give a short introduction in some of the hydraulic properties of channel flow and some basic concept to calculate water levels in rivers, canals, channels etc..
It is NOT intended to be a crash course in hydraulics.

# Equations for open water flow

The flow in rivers as for example the Regge is most often described by the so called St-Venant equations, expressing respectively the mass and the momentum balance (only in *x*-direction):

$$
\begin{align*}
\frac{\partial A}{\partial t} + \frac{\partial Q}{\partial x} &= I &\text{: mass balance}\\
\frac{\partial Q}{\partial t} + \frac{\partial Q\,u}{\partial x} 
            &= g\;A\;\Big( S_o - S_f - \frac{\partial a}{\partial x}\Big) &\text{: momentum balance}
\end{align*}
$$

As we are here less interested in highly dynamic open water calculations, a simplification of the second equation above will be used. This simplification starts from the observation that in many situations (certainly lowland situations) the first two terms in the momentum part of the St-Venant equations are much smaller than the terms on the right hand side.

$$
\frac{\partial Q}{\partial t} + \frac{\partial Q\,u}{\partial x} = 
        g\;A\;\Big( S_o - S_f - \frac{\partial a}{\partial x}\Big)\\
\Downarrow \\
0 = g\;A\;\Big( S_o - S_f - \frac{\partial a}{\partial x}\Big)\\
\Downarrow \\
0 =  S_o - S_f - \frac{\partial a}{\partial x}
$$

gb

Volgens Paul "openwater.pdf" van 2007.

Stationary formulas, including the side inflow

$$
 \frac{\partial Q}{\partial s}=I \\
 \frac{\partial Qu}{\partial s}=g \, A \, \{ S_o+S_f+S_p \}
$$

Rewriting the second equation

$$
u = Q/A ,\,\; \partial A = b\, \partial a ??\\
\frac{\partial Qu}{\partial s}= \frac{\partial}{\partial s}\left ( \frac{Q^2}{A}\right) = \\
2\frac{Q}{A}\frac{\partial Q}{\partial s}-\frac{Q^2}{A^2}\frac{\partial A}{\partial s} = \\
2uI - \frac{Q^2b}{A^2}\frac{\partial a}{\partial s}
$$
Putting the last derived (rewritten) equation into the previous formula block:

$$
\frac{\partial Qu}{\partial s}=g \, A \, \{ S_o+S_f+S_p \} \\
2uI - \frac{Q^2b}{A^2}\frac{\partial a}{\partial s} = g \, A \, \{ S_o+S_f+ \frac{\partial a}{\partial s} \} \\
\left ( 1- \frac{Q^2b}{gA^3}\right ) \frac{\partial a}{\partial s} = S_o - S_f - \frac{2uI}{gA} \\
\Leftrightarrow \frac{\partial a}{\partial s} = \frac{S_o - S_f -S_i}{1-Fr^2}
$$


The meaning of the terms in these equations will be explained when they first appear in this document.

In these exercises situations will be studied where

-   the flow in the Hooge Raam can be considered to be *stationary* (so the time derivatives in the equations above disappear)
-   there is a weir at the downstream end of the river

Situations of this type are often called **backwater curves**.

This type of open water model that will be developed in this document will be coupled with a groundwater model. So at some places typical groundwater terms and dimensions may occur.

The open water has its own standard units:

-   length unit = $\bf{m}$ meter
-   time unit = $\bf{s}$ second

## Geometry of the open water domain

In contrast to groundwater flow, open water flow is limmitid to the open water course itself. This could be simulated in 2D, in de cross sectional and depth domain, or more frequently use averged depth. As can be seen in the abovementionded equations.

The cross sectional geometry of the open water course is of major importance since the hydraulic properties of A, P and R change w.r.t. the water level. Therefor extra intention is paid on this aspect. 
Nowaday many "parenthesis" shaped profiles are used to accommodate base flow and highly discharge events without drastically changing open water levels.
Here we will consider, for simplicity, only trapezoid profiles.
Although simplified, these profiles have non-linear behaviour regarding A,P and R.

Below an illustration of such a trapezoid profile:


$A$ is the wetted Area of the profile, $P$ being the wettted perimeter (the lenght of the profile which is wet due to the water level) and $R$, being the hydraulic radius and determined by: $R=\frac{A}{P}$.

<div class="question">
Suppose this profile has a side slope `m` of 1.5, what are the A,P and R relations as a function of the water level.
</div>

## Wetted area, perimeter and radius of the open water course

One of the important cross section functions is the wetted area. In the St-Venant equation denoted by $A$. For a trapezoidal cross section this can be easily calculated by the following function:

```{r, eval=TRUE}

rm(list = ls())


ow.b = 1
ow.m = 1.5

##Upstream Discharge 
Qup = 2.0 #m3/s

ow.A = function(a)
{
  return(ow.b*a+ow.m*2*a^2)
}

a = seq(0,5, by =0.1)

plot(a,ow.A(a))
grid()


ow.P = function(a)
{
  return(a * 2 *sqrt(1 + ow.m^2))
}

plot(a,ow.P(a))

plot(a,ow.A(a)/ow.P(a))

ow.R = function(a)
{
  return(ow.A(a)/ow.P(a))
}

```

## Bed slope

The open water course will have a slope $S_0$ starting upstream with a higher elevation than downstream. From a perspective of the river this is called a longitudinal profile.  
The slope is calculated as:

$$
S_0 = \frac{dZ}{ds}
$$
With $Z$ being the bottom elevation relative to a datum, usually NAP in the Netherlands. The $s$ stands for the length along the river.



Weir

$$
 Q = \frac{2}{3}\sqrt{2g} C_D b (h - d)^{3/2}
$$
With $C_D$ being the discharge coefficient, for a simple rectangular weir; 0.62
 

```{r}
S0 = 0.001 # 1 m/km


##total length of the river
ow.L = 2000
Zb.fun = approxfun(c(0,-ow.L),c(0,ow.L*S0))
```



## Equilibrium flow

$$
Q_\text{equi} = \frac{1}{n}\sqrt{S_0}AR^{2/3}
$$


```{r}
n = 0.025
a.range = seq(0.1,2,by = 0.1)
Qequi.fun = function(a)
{
  return(1/n * sqrt(S0)* ow.A(a) * ow.R(a)^(2/3))
}

Qequi.range = Qequi.fun(a.range)
plot(Qequi.range,a.range,type = "o", xlab = "Qequi (m3/s)",ylab = "a water depth (m)",
     main = "Equilibrium discharge")
grid()


##finding the equilibrium water depth for a given discharge
a.equilibrium = uniroot(function(a) Qequi.fun(a)-Qup,c(0.1,2))$root
print(paste("the equilibrium water level is : ",a.equilibrium, "for a discharge of ",Qup))

```

## Calculating $\frac{da}{ds}$

$$
 \frac{\partial a}{\partial s} = \frac{S_0 - S_f}{1-Fr^2} \\
 S_f = \frac{n^2 |Q|^2}{A^2R^{4/3}} \\
 Fr = \sqrt{\frac{Q^2B}{gA^3}}
$$

```{r}
#nodal distance
ds = -50
#trajectory of the river
s = seq(0,-ow.L, by = ds)
#create an array for the water depths
a.bw =s
# first downstream prescribed water level
a.bw[1] = 2
# Discharge rate upstream Qup
Qup = 2.0 
for (i in 1:(length(a.bw)-1) )
{
S.f = n^2*abs(Qup)^2/(ow.A(a.bw[i])^2*ow.R(a.bw[i])^(4/3))
Fr = sqrt(Qup^2*ow.b/(9.8*ow.A(a.bw[i])^3))
dads = (S0 - S.f)/(1-Fr^2)
##calculation of the water depths in upstream order
a.bw[i+1] = a.bw[i] + dads*ds
}
## the water level is simply the  water depts + the bottom slope
h.bw = a.bw + Zb.fun(s)

plot(s,h.bw, type = "l",ylim = c(0,max(h.bw)),xlab = "S (m)", ylab = "Water level (m)",
     main = paste("Backwater curve,S0",S0, "Qupstream",Qup),col = "blue",lwd = 3)
lines(s,Zb.fun(s), col = "brown", lwd = 3)
grid()
##plot the water level at equilibirum
lines(s,a.equilibrium + Zb.fun(s), col = "red", lty = 2, lwd = 3)
legend("bottomleft",legend = c("Backwater curve","Bottom elevation","Equilibrium water level"),
       col = c("blue","brown","red"),lty = c(1,1,2),lwd = c(3,3,3))
```

